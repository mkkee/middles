<!DOCTYPE html>
<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style>
       /* Set the size of the div element that contains the map */
      #map {
        height: 500px;  /* The height is 400 pixels */
        width: 70%;  /* The width is the width of the web page */
       }
    </style>
	<link rel="icon" type="image/png" href="img/middles_fav.png" sizes="16x16">
	<link rel="icon" type="image/png" href="img/middles_fav.png" sizes="32x32">
	<link rel="icon" type="image/png" href="img/middles_fav.png" sizes="96x96">
  </head>
  <body>
    <script src=script/middles_data_mid.js></script>

    <!--The div element for the map -->
//check if github commit will work now second time 10
    <div id="map"></div>
	<button onclick="disableAllMarkers();">Clear</button>
	<button onclick="enableAllMarkers();">Enable</button>
	<button onclick="disableAllNonPublic();">Publiczne</button>
	
	
    <script>
//load JSON
var marker_table = []
var infowindow_table = []
var map;

loadJSON();
 function disableAllMarkers() {
	for (m in marker_table) {
		marker_table[m].m.setMap(null);
	}
 }
 
 function enableAllMarkers() {
 	for (m in marker_table) {
		marker_table[m].m.setMap(map);
	}
 }
 
  function disableAllNonPublic() {
	for (m in marker_table) {
		if (marker_table[m].json_data.type == "Niepubliczna") {
			marker_table[m].m.setMap(null);
		}
	}
 }

 function buildInfoWindowSchoolInfo(schoolJSON) {
  iwcontent = "<div class=\"ifw_container\">" 
  iwcontent = iwcontent + "<div class=\"ifw_title\">" + schoolJSON.name +"</div>";
  iwcontent = iwcontent + "<div class=\"ifw_webpage>\">" + schoolJSON.webpage +"</div>";
  iwcontent = iwcontent + "</div>";
  console.log("ifwcontent = "+iwcontent)

  return iwcontent;
 }

// Initialize and add the map
function initMap() {
  // The location of Uluru
  console.log("in init map");
  var waw = {'lat': 52.229158502885544, 'lng': 21.03080616902306};
   // The map, centered at Waw
  map = new google.maps.Map(
      document.getElementById('map'), {zoom: 11, center: waw});
	
  //create all markers and infowindows  
  for (m in data_JSON_tbl) {
	//console.log(data_JSON_tbl[m]);
	//console.log(data_JSON_tbl[m].Geo_Location[0]);	
	//var contentString = data_JSON_tbl[m].name;
  var contentString = buildInfoWindowSchoolInfo(data_JSON_tbl[m]);

	//console.log(contentString);
    var mkinfowindow = new google.maps.InfoWindow({
		  content: contentString
    });	
	var marker =  new google.maps.Marker({
		position: {lat:data_JSON_tbl[m].Geo_Location[0].lat, lng:data_JSON_tbl[m].Geo_Location[0].long},
		map: map,
		title: data_JSON_tbl[m].name,
		draggable: true,
		infowindow: mkinfowindow,
		ifopen: false
	})
	var minfo = {m: marker, json_data: data_JSON_tbl[m]}
	marker_table.push(minfo)
	

 google.maps.event.addListener(marker, 'click', function() {	  
	  if(this.ifopen == false) {
		  this.infowindow.open(map, this);
		  this.ifopen = true;
	  } else {
		  this.infowindow.close(map, this);
		  this.ifopen = false;
	  }
    });
	};
  }
  
  
  console.log("Length of Marker table is: "+marker_table.length);
 // console.log(infowindow_table[0].content)
  //console.log(infowindow_table[1].content)
  //console.log(infowindow_table[2].content)

 
  // The marker, positioned at Uluru
  //var marker = new google.maps.Marker({position: {lat: 52.231427, lng: 21.0005827}, map: map});
  
  var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h1 id="firstHeading" class="firstHeading">Bednarska Szko&#x0142;a Realna</h1>'+
      '<div id="bodyContent">'+
      '<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
      'sandstone rock formation in the southern part of the '+
      'Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) '+
      'south west of the nearest large town, Alice Springs; 450&#160;km '+
      '(280&#160;mi) by road. Kata Tjuta and Uluru are the two major '+
      'features of the Uluru - Kata Tjuta National Park. Uluru is '+
      'sacred to the Pitjantjatjara and Yankunytjatjara, the '+
      'Aboriginal people of the area. It has many springs, waterholes, '+
      'rock caves and ancient paintings. Uluru is listed as a World '+
      'Heritage Site.</p>'+
      '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
      'https://en.wikipedia.org/w/index.php?title=Uluru</a> '+
      '(last visited June 22, 2009).</p>'+
      '</div>'+
      '</div>';

/*  var infowindow = new google.maps.InfoWindow({
    content: contentString
  });
    var marker = new google.maps.Marker({
    position: waw,
    map: map,
    title: 'Warszawa'
  });
  marker.addListener('click', function() {
    infowindow.open(map, marker);
  });*/
  
  
    </script>
    <script async defer
    src='https://maps.googleapis.com/maps/api/js?key=&callback=initMap'>
    </script>
	<script>

	</script>
  </body>
</html>
